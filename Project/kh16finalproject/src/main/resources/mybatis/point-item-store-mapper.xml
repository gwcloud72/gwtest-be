<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="pointitemstore">

  <!-- 상품 등록 -->
<insert id="insert">
    INSERT INTO POINT_ITEM_STORE (
        point_item_no,
        point_item_name,
        point_item_type,
        point_item_content,
        point_item_price,
        point_item_stock,
        point_item_src,
        point_item_req_level,
        POINT_ITEM_IS_LIMITED_PURCHASE,
        POINT_ITEM_DAILY_LIMIT
    )
    VALUES (
        seq_point_item.nextval,
        #{pointItemName},
        #{pointItemType},
        #{pointItemContent},
        #{pointItemPrice},
        #{pointItemStock},
        #{pointItemSrc},
        #{pointItemReqLevel},
        #{pointItemIsLimitedPurchase},
        #{pointItemDailyLimit}
    )
</insert>

<!-- 상품 정보 수정 -->
<update id="update">
    UPDATE POINT_ITEM_STORE
    SET
        point_item_name = #{pointItemName},
        point_item_type = #{pointItemType},
        point_item_content = #{pointItemContent},
        point_item_price = #{pointItemPrice},
        point_item_stock = #{pointItemStock},
        point_item_src = #{pointItemSrc},
        point_item_req_level = #{pointItemReqLevel},
        POINT_ITEM_IS_LIMITED_PURCHASE = #{pointItemIsLimitedPurchase},
        POINT_ITEM_DAILY_LIMIT = #{pointItemDailyLimit}
    WHERE point_item_no = #{pointItemNo}
</update>

<!-- 사용자 상점 상품 목록 조회 (페이징 + 검색) -->
<select id="selectList" resultType="PointItemStoreDto">
    SELECT * FROM (
        SELECT TMP.*, ROWNUM RN FROM (
            SELECT
                point_item_no AS pointItemNo,
                point_item_name AS pointItemName,
                point_item_type AS pointItemType,
                point_item_content AS pointItemContent,
                point_item_price AS pointItemPrice,
                point_item_stock AS pointItemStock,
                point_item_src AS pointItemSrc,
                point_item_reg_date AS pointItemRegDate,
                point_item_req_level AS pointItemReqLevel,
                POINT_ITEM_IS_LIMITED_PURCHASE AS pointItemIsLimitedPurchase,
                POINT_ITEM_DAILY_LIMIT AS pointItemDailyLimit
            FROM POINT_ITEM_STORE
            <where>
                <if test="itemType != null and itemType != '' and itemType != 'ALL'">
                    AND point_item_type = #{itemType}
                </if>
                <if test="keyword != null and keyword != ''">
                    AND UPPER(point_item_name) LIKE UPPER('%' || #{keyword} || '%')
                </if>
            </where>
            ORDER BY point_item_no DESC
        ) TMP
    )
    WHERE RN BETWEEN #{begin} AND #{end}
</select>

<!-- 사용자 상점 상품 개수 조회 -->
<select id="selectCount" resultType="int">
    SELECT COUNT(*)
    FROM point_item_store
    <where>
        <if test="itemType != null and itemType != '' and itemType != 'ALL'">
            AND point_item_type = #{itemType}
        </if>
        <if test="keyword != null and keyword != ''">
            AND UPPER(point_item_name) LIKE UPPER('%' || #{keyword} || '%')
        </if>
    </where>
</select>

<!-- 상품 단건 조회 -->
<select id="selectOneNumber" resultType="PointItemStoreDto">
    SELECT *
    FROM POINT_ITEM_STORE
    WHERE point_item_no = #{itemNo}
</select>

<!-- 상품 삭제 -->
<delete id="delete">
    DELETE FROM POINT_ITEM_STORE
    WHERE point_item_no = #{pointItemNo}
</delete>

<!-- 관리자 상품 목록 조회 -->
<select id="selectAdminList" resultType="PointItemStoreDto">
    SELECT * FROM (
        SELECT TMP.*, ROWNUM RN FROM (
            SELECT *
            FROM point_item_store
            <where>
                <if test="itemType != null and itemType != ''">
                    AND point_item_type = #{itemType}
                </if>
                <if test="keyword != null and keyword != ''">
                    AND UPPER(point_item_name) LIKE UPPER('%' || #{keyword} || '%')
                </if>
            </where>
            ORDER BY point_item_no DESC
        ) TMP
    )
    WHERE RN BETWEEN #{begin} AND #{end}
</select>

<!-- 관리자 상품 개수 조회 -->
<select id="selectAdminCount" resultType="int">
    SELECT COUNT(*)
    FROM point_item_store
    <where>
        <if test="itemType != null and itemType != ''">
            AND point_item_type = #{itemType}
        </if>
        <if test="keyword != null and keyword != ''">
            AND UPPER(point_item_name) LIKE UPPER('%' || #{keyword} || '%')
        </if>
    </where>
</select>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="attendanceHistory">

    <!-- 출석 기록 등록 -->
    <insert id="insert">
        INSERT INTO attendance_history (
            attendance_history_no, 
            attendance_history_member_id
        ) VALUES (
            seq_attendance_history.nextval,   <!-- 출석 이력 번호 -->
            #{attendanceHistoryMemberId}      <!-- 회원 ID -->
        )
    </insert>

    <!-- 회원별 출석 이력 조회 -->
    <select id="selectList" resultType="attendanceHistoryDto">
        SELECT *
        FROM attendance_history
        WHERE attendance_history_member_id = #{memberId}
        ORDER BY attendance_history_date DESC
    </select>

    <!-- 출석 기록 1건 삭제 -->
    <delete id="delete">
        DELETE FROM attendance_history
        WHERE attendance_history_no = #{no}
    </delete>

    <!-- 회원의 출석 기록 전체 삭제 -->
    <delete id="deleteAll">
        DELETE FROM attendance_history
        WHERE attendance_history_member_id = #{memberId}
    </delete>

    <!-- 캘린더 표시용 출석 날짜 조회 -->
    <select id="selectCalendarDates" resultType="string">
        SELECT TO_CHAR(attendance_history_date, 'YYYY-MM-DD')
        FROM attendance_history
        WHERE attendance_history_member_id = #{memberId}
        ORDER BY attendance_history_date ASC
    </select>

</mapper>
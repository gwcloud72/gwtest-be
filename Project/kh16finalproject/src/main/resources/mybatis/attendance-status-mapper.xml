<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="attendanceStatus">
 <!-- 회원의 출석 상태 조회 -->
    <select id="selectOne" resultType="attendanceStatusDto">
        SELECT *
        FROM attendance_status
        WHERE attendance_status_member_id = #{memberId}
    </select>

    <!-- 출석 상태 최초 생성 -->
    <insert id="insert">
        INSERT INTO attendance_status (
            attendance_status_no,
            attendance_status_member_id,
            attendance_status_current,
            attendance_status_max,
            attendance_status_total
        ) VALUES (
            seq_attendance_status.nextval,   <!-- PK -->
            #{attendanceStatusMemberId},     <!-- 회원 ID -->
            1,                               <!-- 현재 연속 출석 -->
            1,                               <!-- 최대 연속 출석 -->
            1                                <!-- 누적 출석 횟수 -->
        )
    </insert>

    <!-- 출석 시 상태 갱신 -->
    <update id="update">
        UPDATE attendance_status SET
            attendance_status_current = #{attendanceStatusCurrent},
            attendance_status_max = #{attendanceStatusMax},
            attendance_status_total = attendance_status_total + 1,
            attendance_status_lastdate = SYSTIMESTAMP
        WHERE attendance_status_member_id = #{attendanceStatusMemberId}
    </update>

    <!-- 회원 출석 상태 삭제 -->
    <delete id="delete">
        DELETE FROM attendance_status
        WHERE attendance_status_member_id = #{memberId}
    </delete>

</mapper>
	
